define(["jquery","core/ajax"],function(i,r){return{init:function(o){i(document).ready(function(){i("#block_activity_discuss_form_message_feedback").html(1500+o.charactersremainingtext),i("#block_activity_discuss_form_message").keyup(function(){var e=1500-i("#block_activity_discuss_form_message").val().length;i("#block_activity_discuss_form_message_feedback").html(e+o.charactersremainingtext)})}),i("#form-course-discuss-create-post").click(function(e){e.preventDefault();var t=i("#course-discuss-discussion-form").serializeArray().reduce(function(e,t){return e[t.name]=t.value,e},{});""!=t.message?r.call([{methodname:"block_activity_discuss_create_discussion",args:{courseid:t.courseid,forumid:t.forumid,contextid:t.contextid,message:t.message,pageinternalid:t.pageinternalid,pagename:t.pagename},done:function(){var e=arguments[0];t.discussionid=e.discussionid,t.subject="","discussionnotcreated"==e.eventaction?(i("#comment_0").html("<h3>"+o.postcouldnotbeaddedtext+"</h3>"),i("#comment_0").append(o.errortitletext+' "'+e.errormessage+'".<br>')):e.warnings?(i("#comment_0").html("<h3>"+o.warninginternalerrortext+"</h3>"),i("#comment_0").append(o.warningtitletext+e.warning)):r.call([{methodname:"block_activity_discuss_display_reply_form",args:{courseid:t.courseid,forumid:t.forumid,pageinternalid:t.pageinternalid,pagename:t.pagename,discussionid:t.discussionid,parentpostid:0},done:function(){var e=arguments[0];i("#block_activity_discuss_reply_container").html(e.html),(e=n(t))[0].done(function(){var e=arguments[0];"postnotcreated"==e.eventaction?(i("#comment_0").append("<h3>"+o.postcouldnotbeaddedtext+"</h3>"),i("#comment_0").append(o.errortitletext+' "'+e.errormessage+'".<br>')):(i("#comment_0").append("<h3>"+o.thankyouforpostingtext+"</h3>"),i("#block_activity_discuss_form_message").val(""),i("#comment_0").fadeOut(3e3,function(){i("#comment_0").show(),i("#comment_0").text(""),location.reload()}))}).fail(function(e){i("#comment_0").append("<h3>"+o.postcouldnotbeaddedtext+"</h3>"),i("#comment_0").append(o.errortitletext+' "'+e.message+'".<br>')})},fail:function(e){i("#comment_0").html("<h3>"+o.discussioncreatedinternalerrortext+"</h3>"),i("#comment_0").append(e.message)}}])},fail:function(e){i("#comment_0").html("<h3>"+o.postcouldnotbeaddedtext+"</h3>"),i("#comment_0").append(o.errortitletext+' "'+e.message+'".<br>'),i("#block_activity_discuss_form_message").val("")}}]):i("#comment_0").html('<h3 class="block_activity_discuss_error">'+o.pleaseaddmessagetext+"</h3>")}),i("#block_activity_discuss_reply_container").on("submit","form",function(e){e.preventDefault();var t=i("#course-discuss-discussion-form").serializeArray().reduce(function(e,t){return e[t.name]=t.value,e},{});""!=t.message?(t.subject="",t.parentpostid=0,n(t)[0].done(function(){var e=arguments[0];"postnotcreated"==e.eventaction?(i("#comment_0").append("<h3>"+o.postcouldnotbeaddedtext+"</h3>"),i("#comment_0").append(o.errortitletext+' "'+e.errormessage+'".<br>')):(i("#comment_0").append("<h3>"+o.thankyouforpostingtext+"</h3>"),i("#block_activity_discuss_form_message").val(""),i("#comment_0").fadeOut(3e3,function(){i("#comment_0").show(),i("#comment_0").text(""),s(t)}))}).fail(function(e){i("#comment_0").append("<h3>"+o.postcouldnotbeaddedtext+"</h3>"),i("#comment_0").append(o.errortitletext+' "'+e.message+'".<br>')})):i("#comment_0").html('<h3 class="block_activity_discuss_error">'+o.pleaseaddmessagetext+"</h3>")}),i(".course-discuss-feed-container").on("click",function(e){if("block_activity_discuss_action_button"==e.target.getAttribute("class")){var t=i(e.target).val(),s=i("#course-discuss-discussion-form").serializeArray().reduce(function(e,t){return e[t.name]=t.value,e},{});r.call([{methodname:"block_activity_discuss_display_reply_form",args:{courseid:s.courseid,forumid:s.forumid,pageinternalid:s.pageinternalid,pagename:s.pagename,discussionid:s.discussionid,parentpostid:t},done:function(){var e=arguments[0];i("#course-discuss-reply-form-container_"+t).html(e.html),i("#course-discuss-reply-form-container_"+t+" #block_activity_discuss_form_message").focus()},fail:function(e){i("#comment_"+t).html("<h3>"+o.errordisplayreplyformtext+"</h3>"),i("#comment_"+t).append(o.errortitletext+' "'+e.message+'".<br>')}}])}}),i(".course-discuss-feed-container").on("submit","form",function(e){e.preventDefault();var t=i(this).serializeArray().reduce(function(e,t){return e[t.name]=t.value,e},{});""!=t.message?n(t)[0].done(function(){var e=arguments[0];"postnotcreated"==e.eventaction?(i("#comment_"+t.parentpostid).append("<h3>"+o.postcouldnotbeaddedtext+"</h3>"),i("#comment_"+t.parentpostid).append(o.errortitletext+' "'+e.errormessage+'".<br>')):(i("#comment_"+t.parentpostid).append("<h3>"+o.thankyouforpostingtext+"</h3>"),i("#course-discuss-reply-form-container_"+t.parentpostid).html(""),i("#comment_"+t.parentpostid).fadeOut(3e3,function(){i("#comment_"+t.parentpostid).show(),i("#comment_"+t.parentpostid).text(""),s(t,t.discussionid)}))}).fail(function(e){i("#comment_"+t.parentpostid).append("<h3>"+o.postcouldnotbeaddedtext+"</h3>"),i("#comment_"+t.parentpostid).append(o.errortitletext+' "'+e.message+'".<br>')}):i("#comment_"+t.parentpostid).html('<h3 class="block_activity_discuss_error">'+o.pleaseaddmessagetext+"</h3>")}),i(".course-discuss-feed-container").on("reset","form",function(e){e.preventDefault();var t=i(this).serializeArray().reduce(function(e,t){return e[t.name]=t.value,e},{});i("#course-discuss-reply-form-container_"+t.parentpostid).html("")});var s=function(s){return r.call([{methodname:"block_activity_discuss_display_discussion",args:{courseid:s.courseid,forumid:s.forumid,discussionid:s.discussionid},done:function(){var e=arguments[0],t="";s.usermessage&&(t=s.usermessage),t+=e.html,i(".course-discuss-feed-container").html(t)},fail:function(e){i("#comment_0").html("<h3>"+o.errordisplayingdiscussiontext+"</h3>"),i("#comment_0").append(o.errortitletext+' "'+e.message+'".<br>')}}])},n=function(e){return r.call([{methodname:"block_activity_discuss_create_post",args:{courseid:e.courseid,forumid:e.forumid,contextid:e.contextid,message:e.message,discussionid:e.discussionid,subject:e.subject,parentpostid:e.parentpostid}}])}}}});