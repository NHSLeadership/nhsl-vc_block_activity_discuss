define(["jquery","core/ajax"],function(r,c){return{init:function(o){r(document).ready(function(){r("#block_activity_discuss_form_message_feedback").html(1200+o.charactersremainingtext),r("#block_activity_discuss_form_message").keyup(function(){var e=1200-r("#block_activity_discuss_form_message").val().length;r("#block_activity_discuss_form_message_feedback").html(e+o.charactersremainingtext)})}),r("#form-course-discuss-create-post").click(function(e){e.preventDefault();var t=r("#course-discuss-discussion-form").serializeArray().reduce(function(e,t){return e[t.name]=t.value,e},{});""!=t.message?c.call([{methodname:"block_activity_discuss_create_discussion",args:{courseid:t.courseid,forumid:t.forumid,contextid:t.contextid,message:t.message,pageinternalid:t.pageinternalid,pagename:t.pagename},done:function(){var e=arguments[0];t.discussionid=e.discussionid,t.subject="","discussionnotcreated"==e.eventaction?(r("#comment_0").html("<h3>"+o.postcouldnotbeaddedtext+"</h3>"),r("#comment_0").append(o.errortitletext+' "'+e.errormessage+'".<br>')):e.warnings?(r("#comment_0").html("<h3>"+o.warninginternalerrortext+"</h3>"),r("#comment_0").append(o.warningtitletext+e.warning)):c.call([{methodname:"block_activity_discuss_display_reply_form",args:{courseid:t.courseid,forumid:t.forumid,pageinternalid:t.pageinternalid,pagename:t.pagename,discussionid:t.discussionid,parentpostid:0},done:function(){var e=arguments[0];r("#block_activity_discuss_reply_container").html(e.html),(e=n(t))[0].done(function(){var e=arguments[0];"postnotcreated"==e.eventaction?(r("#comment_0").append("<h3>"+o.postcouldnotbeaddedtext+"</h3>"),r("#comment_0").append(o.errortitletext+' "'+e.errormessage+'".<br>')):(r("#comment_0").append("<h3>"+o.thankyouforpostingtext+"</h3>"),r("#block_activity_discuss_form_message").val(""),r("#comment_0").fadeOut(3e3,function(){r("#comment_0").show(),r("#comment_0").text(""),s(t,t.discussionid)}))}).fail(function(e){r("#comment_0").append("<h3>"+o.postcouldnotbeaddedtext+"</h3>"),r("#comment_0").append(o.errortitletext+' "'+e.message+'".<br>')})},fail:function(e){r("#comment_0").html("<h3>"+o.discussioncreatedinternalerrortext+"</h3>"),r("#comment_0").append(e.message)}}])},fail:function(e){r("#comment_0").html("<h3>"+o.postcouldnotbeaddedtext+"</h3>"),r("#comment_0").append(o.errortitletext+' "'+e.message+'".<br>'),r("#block_activity_discuss_form_message").val("")}}]):r("#comment_0").html('<h3 class="block_activity_discuss_error">'+o.pleaseaddmessagetext+"</h3>")}),r("#block_activity_discuss_reply_container").on("submit","form",function(e){e.preventDefault();var t=r("#course-discuss-discussion-form").serializeArray().reduce(function(e,t){return e[t.name]=t.value,e},{});""!=t.message?(t.subject="",t.parentpostid=0,n(t)[0].done(function(){var e=arguments[0];"postnotcreated"==e.eventaction?(r("#comment_0").append("<h3>"+o.postcouldnotbeaddedtext+"</h3>"),r("#comment_0").append(o.errortitletext+' "'+e.errormessage+'".<br>')):(r("#comment_0").append("<h3>"+o.thankyouforpostingtext+"</h3>"),r("#block_activity_discuss_form_message").val(""),r("#comment_0").fadeOut(3e3,function(){r("#comment_0").show(),r("#comment_0").text(""),s(t)}))}).fail(function(e){r("#comment_0").append("<h3>"+o.postcouldnotbeaddedtext+"</h3>"),r("#comment_0").append(o.errortitletext+' "'+e.message+'".<br>')})):r("#comment_0").html('<h3 class="block_activity_discuss_error">'+o.pleaseaddmessagetext+"</h3>")}),r(".course-discuss-feed-container").on("click",function(e){if("block_activity_discuss_action_button"==e.target.getAttribute("class")){var t=r(e.target).val(),s=r("#course-discuss-discussion-form").serializeArray().reduce(function(e,t){return e[t.name]=t.value,e},{});c.call([{methodname:"block_activity_discuss_display_reply_form",args:{courseid:s.courseid,forumid:s.forumid,pageinternalid:s.pageinternalid,pagename:s.pagename,discussionid:s.discussionid,parentpostid:t},done:function(){var e=arguments[0];r("#course-discuss-reply-form-container_"+t).html(e.html),r("#course-discuss-reply-form-container_"+t+" #block_activity_discuss_form_message").focus()},fail:function(e){r("#comment_"+t).html("<h3>"+o.errordisplayreplyformtext+"</h3>"),r("#comment_"+t).append(o.errortitletext+' "'+e.message+'".<br>')}}])}}),r(".course-discuss-feed-container").on("submit","form",function(e){e.preventDefault();var t=r(this).serializeArray().reduce(function(e,t){return e[t.name]=t.value,e},{});""!=t.message?n(t)[0].done(function(){var e=arguments[0];"postnotcreated"==e.eventaction?(r("#comment_"+t.parentpostid).append("<h3>"+o.postcouldnotbeaddedtext+"</h3>"),r("#comment_"+t.parentpostid).append(o.errortitletext+' "'+e.errormessage+'".<br>')):(r("#comment_"+t.parentpostid).append("<h3>"+o.thankyouforpostingtext+"</h3>"),r("#course-discuss-reply-form-container_"+t.parentpostid).html(""),r("#comment_"+t.parentpostid).fadeOut(3e3,function(){r("#comment_"+t.parentpostid).show(),r("#comment_"+t.parentpostid).text(""),s(t,t.discussionid)}))}).fail(function(e){r("#comment_"+t.parentpostid).append("<h3>"+o.postcouldnotbeaddedtext+"</h3>"),r("#comment_"+t.parentpostid).append(o.errortitletext+' "'+e.message+'".<br>')}):r("#comment_"+t.parentpostid).html('<h3 class="block_activity_discuss_error">'+o.pleaseaddmessagetext+"</h3>")}),r(".course-discuss-feed-container").on("reset","form",function(e){e.preventDefault();var t=r(this).serializeArray().reduce(function(e,t){return e[t.name]=t.value,e},{});r("#course-discuss-reply-form-container_"+t.parentpostid).html("")});var s=function(s){return c.call([{methodname:"block_activity_discuss_display_discussion",args:{courseid:s.courseid,forumid:s.forumid,discussionid:s.discussionid},done:function(){var e=arguments[0],t="";s.usermessage&&(t=s.usermessage),t+=e.html,r(".course-discuss-feed-container").html(t)},fail:function(e){r("#comment_0").html("<h3>"+o.errordisplayingdiscussiontext+"</h3>"),r("#comment_0").append(o.errortitletext+' "'+e.message+'".<br>')}}])},n=function(e){return c.call([{methodname:"block_activity_discuss_create_post",args:{courseid:e.courseid,forumid:e.forumid,contextid:e.contextid,message:e.message,discussionid:e.discussionid,subject:e.subject,parentpostid:e.parentpostid}}])}}}});